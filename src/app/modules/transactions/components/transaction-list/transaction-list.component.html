<div class="transaction-container">
  <div class="transaction-header">
    <h2>Transactions</h2>
    <button class="btn btn-primary" (click)="newTransaction()">+ Nouvelle Transaction</button>
  </div>

  <div class="filters">
    <div class="search-box">
      <input
        type="text"
        placeholder="Rechercher une transaction..."
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
        class="form-control"
      />
    </div>

    <select class="form-control" [(ngModel)]="filterStatus" (change)="onFilterChange()">
      <option value="all">Tous les statuts</option>
      <option value="pending">En attente</option>
      <option value="confirmed">Confirmée</option>
      <option value="paid">Payée</option>
      <option value="rejected">Rejetée</option>
    </select>

    <select class="form-control" [(ngModel)]="filterType" (change)="onFilterChange()">
      <option value="all">Tous les types</option>
      <option value="invoice">Facture</option>
      <option value="expense">Dépense</option>
      <option value="transfer">Transfert</option>
      <option value="income">Revenu</option>
    </select>

    <div class="date-range">
      <label>De:</label>
      <input
        type="date"
        [(ngModel)]="startDate"
        (change)="onFilterChange()"
        class="form-control"
      />
      <label>À:</label>
      <input
        type="date"
        [(ngModel)]="endDate"
        (change)="onFilterChange()"
        class="form-control"
      />
    </div>
  </div>

  <div class="transaction-table">
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Type</th>
          <th>Statut</th>
          <th>Montant</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let transaction of filteredTransactions">
          <td>{{ transaction.date | date: 'dd/MM/yyyy' }}</td>
          <td>{{ transaction.description }}</td>
          <td>
            <span class="badge" [ngClass]="getTypeClass(transaction.type)">
              {{ getTypeLabel(transaction.type) }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="getStatusClass(transaction.status)">
              {{ getStatusLabel(transaction.status) }}
            </span>
          </td>
          <td [class.text-success]="transaction.type === 'income'" [class.text-danger]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? '+' : '-' }}{{ transaction.amount }} TND
          </td>
          <td class="actions">
            <button class="btn btn-sm btn-info" (click)="viewTransaction(transaction.id)">Voir</button>
            <button class="btn btn-sm btn-warning" (click)="editTransaction(transaction.id)" *ngIf="transaction.status === 'pending'">Modifier</button>
            
            <!-- Approval buttons for pending transactions -->
            <button 
              class="btn btn-sm btn-success" 
              (click)="approveTransaction(transaction)" 
              *ngIf="canApprove(transaction)"
              [disabled]="processingId === transaction.id">
              <span *ngIf="processingId === transaction.id">...</span>
              <span *ngIf="processingId !== transaction.id">Approuver</span>
            </button>
            <button 
              class="btn btn-sm btn-danger" 
              (click)="rejectTransaction(transaction)" 
              *ngIf="canReject(transaction)"
              [disabled]="processingId === transaction.id">
              Rejeter
            </button>

            <!-- Payment button for confirmed transactions -->
            <button 
              class="btn btn-sm btn-info" 
              (click)="markAsPaid(transaction)" 
              *ngIf="canMarkAsPaid(transaction)"
              [disabled]="processingId === transaction.id">
              <span *ngIf="processingId === transaction.id">...</span>
              <span *ngIf="processingId !== transaction.id">Payer</span>
            </button>

            <!-- Delete button -->
            <button class="btn btn-sm btn-outline-danger" (click)="deleteTransaction(transaction.id)" *ngIf="transaction.status === 'pending'">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination" *ngIf="totalItems > pageSize">
      <button
        class="btn btn-secondary"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        Précédent
      </button>
      <span>Page {{ currentPage }} sur {{ Math.ceil(totalItems / pageSize) }}</span>
      <button
        class="btn btn-secondary"
        (click)="nextPage()"
        [disabled]="currentPage >= Math.ceil(totalItems / pageSize)"
      >
        Suivant
      </button>
    </div>
  </div>
</div>
